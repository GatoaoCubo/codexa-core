{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://codexa.app/schemas/photo_agent/marketplace_output/v1.0.0",
  "title": "Photo Agent Marketplace Output Schema",
  "description": "Output schema for photo_agent specialized in marketplace product photography (ML, Shopee, Amazon BR, Magalu) with anuncio_agent integration",
  "version": "1.0.0",
  "type": "object",

  "required": [
    "metadata",
    "prompts_grid_3x3",
    "reference_instructions",
    "quality_report",
    "marketplace_compliance",
    "trinity_output"
  ],

  "properties": {
    "metadata": {
      "type": "object",
      "description": "Output metadata and generation information",
      "required": [
        "agent",
        "version",
        "timestamp",
        "input_hash",
        "workflow_type"
      ],
      "properties": {
        "agent": {
          "type": "string",
          "const": "photo_agent_marketplace",
          "description": "Agent identifier for marketplace workflow"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Agent version (semantic versioning)"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Generation timestamp (ISO 8601)"
        },
        "input_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA256 hash of input data for traceability"
        },
        "workflow_type": {
          "type": "string",
          "const": "marketplace_product",
          "description": "Workflow type identifier"
        },
        "generation_time_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Total generation time in milliseconds"
        },
        "input_subject": {
          "type": "string",
          "description": "Original product subject from input"
        },
        "target_marketplace": {
          "type": "string",
          "enum": ["mercadolivre", "shopee", "magalu", "amazon_br", "all"],
          "description": "Target marketplace for compliance"
        },
        "anuncio_agent_integration": {
          "type": "boolean",
          "default": true,
          "description": "Indicates if output is optimized for anuncio_agent integration"
        }
      },
      "additionalProperties": false
    },

    "prompts_grid_3x3": {
      "type": "array",
      "description": "9 photography prompts for 3x3 grid layout (scenes 1-9)",
      "minItems": 9,
      "maxItems": 9,
      "items": {
        "type": "object",
        "required": [
          "scene_number",
          "scene_name",
          "scene_role",
          "prompt_with_reference",
          "technical_specs",
          "compliance_white_bg",
          "pnl_trigger",
          "validation_score"
        ],
        "properties": {
          "scene_number": {
            "type": "integer",
            "minimum": 1,
            "maximum": 9,
            "description": "Scene number in 3x3 grid (1=top-left, 5=center, 9=bottom-right)"
          },
          "scene_name": {
            "type": "string",
            "description": "Human-readable scene name",
            "examples": [
              "Hero White Background (Marketplace Thumbnail)",
              "Lifestyle Use Context",
              "Macro Detail Quality",
              "User Hand Interaction",
              "Benefit Demonstration",
              "Top-down Functional View",
              "Environment Context",
              "Material Quality Close-up",
              "Commercial Cover (White Background)"
            ]
          },
          "scene_role": {
            "type": "string",
            "enum": [
              "hero_white",
              "lifestyle",
              "macro",
              "user_interaction",
              "benefit",
              "topdown",
              "environment",
              "material",
              "commercial_cover"
            ],
            "description": "Scene role in marketplace narrative arc"
          },
          "prompt_with_reference": {
            "type": "string",
            "minLength": 100,
            "maxLength": 400,
            "description": "Full prompt with {REFERENCE_IMAGE} placeholder for user to paste product image. CRITICAL: User MUST attach/paste reference image when using this prompt.",
            "examples": [
              "Professional product photography fiel ao {INSERIR_IMAGEM_PRODUTO_AQUI}, pure white background #FFFFFF, centered composition, camera 50mm f/8 1/160s ISO 100, high-key lighting soft uniform shadows, full sharp focus, no watermarks, no text, no third-party logos, 8K quality, marketplace compliant"
            ]
          },
          "reference_image_instructions": {
            "type": "string",
            "description": "Explicit instructions on how to use reference image with this prompt",
            "examples": [
              "⚠️ ANTES DE GERAR: Cole/anexe a imagem do produto no lugar de {INSERIR_IMAGEM_PRODUTO_AQUI}. A IA vai usar sua imagem como referência 100% fiel para gerar a cena.",
              "⚠️ IMPORTANTE: Substitua {INSERIR_IMAGEM_PRODUTO_AQUI} pela URL ou faça upload da foto real do produto. Sem a imagem de referência, a fidelidade será perdida."
            ]
          },
          "technical_specs": {
            "type": "object",
            "description": "Technical photography specifications",
            "required": [
              "camera",
              "lighting",
              "background",
              "composition"
            ],
            "properties": {
              "camera": {
                "type": "string",
                "description": "Complete camera specification",
                "examples": ["50mm f/8 1/160s ISO 100"]
              },
              "focal_length": {
                "type": "string",
                "pattern": "^\\d{2,3}mm$",
                "examples": ["50mm", "85mm"]
              },
              "aperture": {
                "type": "string",
                "pattern": "^f/\\d+(\\.\\d+)?$",
                "examples": ["f/2.8", "f/8"]
              },
              "shutter_speed": {
                "type": "string",
                "pattern": "^1/\\d+s$",
                "examples": ["1/160s"]
              },
              "iso": {
                "type": "integer",
                "enum": [100, 200, 400, 800]
              },
              "lighting": {
                "type": "string",
                "description": "Lighting setup",
                "examples": ["High-key clean, soft uniform shadows"]
              },
              "background": {
                "type": "string",
                "description": "Background specification (MUST be #FFFFFF for scenes 1 and 9)",
                "examples": ["#FFFFFF pure white", "Real lifestyle environment"]
              },
              "composition": {
                "type": "string",
                "examples": ["Centered, rule of thirds"]
              },
              "depth_of_field": {
                "type": "string",
                "enum": ["ultra_shallow", "shallow", "moderate", "deep", "full_focus"]
              }
            },
            "additionalProperties": false
          },
          "compliance_white_bg": {
            "type": "boolean",
            "description": "TRUE if scene MUST have white background #FFFFFF (scenes 1 and 9 ALWAYS true for marketplace compliance)"
          },
          "marketplace_purpose": {
            "type": "string",
            "enum": [
              "main_thumbnail",
              "lifestyle_context",
              "detail_zoom",
              "usage_demo",
              "benefit_proof",
              "functional_view",
              "environment_shot",
              "quality_proof",
              "cover_image"
            ],
            "description": "Specific marketplace listing purpose"
          },
          "pnl_trigger": {
            "type": "string",
            "description": "Programação neurolinguística emotional anchor (Brazilian Portuguese)",
            "examples": [
              "clareza imediata na escolha, sem dúvidas",
              "qualidade visível que justifica o investimento",
              "confiança no acabamento profissional"
            ]
          },
          "pnl_trigger_key": {
            "type": "string",
            "enum": [
              "confiança",
              "clareza",
              "desejo",
              "urgência",
              "segurança",
              "exclusividade"
            ]
          },
          "validation_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Validation score (0.0-1.0, ≥0.90 = PASS for marketplace)"
          },
          "character_count": {
            "type": "integer",
            "minimum": 100,
            "maximum": 400
          },
          "validation_status": {
            "type": "string",
            "enum": ["PASS", "FAIL"]
          },
          "file_name_suggestion": {
            "type": "string",
            "pattern": "^[a-z0-9_]+_cena_0[1-9]_[a-z_]+\\.png$",
            "description": "Suggested file name for generated image",
            "examples": [
              "garrafa_agua_cena_01_hero_branco.png",
              "garrafa_agua_cena_09_cover_branco.png"
            ]
          }
        },
        "additionalProperties": false
      }
    },

    "reference_instructions": {
      "type": "object",
      "description": "CRITICAL instructions on how to use reference images with prompts",
      "required": [
        "workflow_overview",
        "step_by_step",
        "fidelity_guarantee",
        "supported_formats"
      ],
      "properties": {
        "workflow_overview": {
          "type": "string",
          "description": "High-level workflow explanation",
          "examples": [
            "Este output gera 9 PROMPTS prontos para copiar e colar. CADA PROMPT contém {INSERIR_IMAGEM_PRODUTO_AQUI} que você DEVE substituir pela imagem real do produto antes de gerar. Isso garante fidelidade 100% ao produto original em todas as 9 cenas."
          ]
        },
        "step_by_step": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 4,
          "description": "Step-by-step instructions for using prompts",
          "examples": [
            [
              "1. Tenha a IMAGEM DO PRODUTO pronta (PNG, JPG, WEBP, ou URL pública)",
              "2. Copie o PROMPT da cena desejada (ex: Cena 1 - Hero White)",
              "3. COLE/ANEXE a imagem do produto no lugar de {INSERIR_IMAGEM_PRODUTO_AQUI}",
              "4. Cole o prompt completo (com imagem) na LLM geradora (Gemini 2.5 Flash, DALL-E 3, Midjourney, etc.)",
              "5. Gere a imagem. Repita para cada uma das 9 cenas."
            ]
          ]
        },
        "fidelity_guarantee": {
          "type": "string",
          "description": "Explanation of how reference image ensures fidelity",
          "examples": [
            "⚠️ IMPORTANTE: Anexar a imagem de referência em CADA geração garante que a IA mantenha fidelidade ao produto original (forma, cor, textura, detalhes) em todas as 9 cenas. SEM a imagem, a IA vai 'inventar' um produto genérico."
          ]
        },
        "supported_formats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["PNG", "JPG", "JPEG", "WEBP", "URL"]
          },
          "description": "Supported reference image formats"
        },
        "recommended_resolution": {
          "type": "string",
          "description": "Recommended resolution for reference image",
          "examples": ["1024x1024 mínimo, 2048x2048 ideal para detalhes"]
        }
      },
      "additionalProperties": false
    },

    "quality_report": {
      "type": "object",
      "description": "Quality assurance and marketplace compliance validation",
      "required": [
        "total_prompts",
        "validation_passed",
        "avg_validation_score",
        "marketplace_compliance_status",
        "white_bg_scenes_count",
        "warnings",
        "errors"
      ],
      "properties": {
        "total_prompts": {
          "type": "integer",
          "const": 9,
          "description": "Total prompts (always 9 for 3x3 grid)"
        },
        "validation_passed": {
          "type": "integer",
          "minimum": 0,
          "maximum": 9,
          "description": "Prompts that passed validation (score ≥0.90)"
        },
        "validation_failed": {
          "type": "integer",
          "minimum": 0,
          "maximum": 9
        },
        "avg_validation_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Average validation score (target ≥0.92 for marketplace)"
        },
        "avg_character_count": {
          "type": "number",
          "minimum": 100,
          "maximum": 400
        },
        "marketplace_compliance_status": {
          "type": "string",
          "enum": ["FULL_COMPLIANCE", "PARTIAL_COMPLIANCE", "NON_COMPLIANT"],
          "description": "Overall marketplace compliance (FULL = scenes 1+9 white bg + all validations passed)"
        },
        "white_bg_scenes_count": {
          "type": "integer",
          "minimum": 2,
          "maximum": 9,
          "description": "Number of scenes with white background #FFFFFF (MUST be ≥2 for scenes 1+9)"
        },
        "white_bg_scenes": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 1,
            "maximum": 9
          },
          "description": "Scene numbers with white background (MUST include [1, 9])"
        },
        "compliance_details": {
          "type": "object",
          "description": "13-point marketplace compliance checklist",
          "properties": {
            "scene_1_white_bg": {
              "type": "boolean",
              "description": "Scene 1 (Hero) has #FFFFFF background (CRITICAL)"
            },
            "scene_9_white_bg": {
              "type": "boolean",
              "description": "Scene 9 (Cover) has #FFFFFF background (CRITICAL)"
            },
            "all_lengths_valid": {
              "type": "boolean",
              "description": "All prompts 100-400 characters"
            },
            "all_camera_specified": {
              "type": "boolean",
              "description": "All prompts have camera specs"
            },
            "all_lighting_described": {
              "type": "boolean",
              "description": "All prompts describe lighting"
            },
            "all_background_mentioned": {
              "type": "boolean",
              "description": "All prompts mention background"
            },
            "all_composition_defined": {
              "type": "boolean",
              "description": "All prompts define composition"
            },
            "all_8k_stated": {
              "type": "boolean",
              "description": "All prompts state '8K quality'"
            },
            "all_no_watermarks": {
              "type": "boolean",
              "description": "All prompts include 'no watermarks'"
            },
            "all_no_text": {
              "type": "boolean",
              "description": "All prompts include 'no text'"
            },
            "all_no_logos": {
              "type": "boolean",
              "description": "All prompts include 'no third-party logos'"
            },
            "all_pnl_included": {
              "type": "boolean",
              "description": "All prompts include PNL trigger"
            },
            "all_reference_placeholder": {
              "type": "boolean",
              "description": "All prompts include {INSERIR_IMAGEM_PRODUTO_AQUI} placeholder"
            }
          }
        },
        "warnings": {
          "type": "array",
          "description": "Non-critical warnings",
          "items": {
            "type": "object",
            "properties": {
              "scene": {"type": "integer"},
              "code": {"type": "string"},
              "message": {"type": "string"},
              "severity": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              }
            }
          }
        },
        "errors": {
          "type": "array",
          "description": "Critical errors requiring fix",
          "items": {
            "type": "object",
            "properties": {
              "scene": {"type": "integer"},
              "code": {"type": "string"},
              "message": {"type": "string"},
              "auto_corrected": {"type": "boolean"}
            }
          }
        },
        "performance_metrics": {
          "type": "object",
          "properties": {
            "generation_time_ms": {"type": "number"},
            "validation_time_ms": {"type": "number"},
            "total_time_ms": {"type": "number"},
            "target_met": {
              "type": "boolean",
              "description": "Whether performance target (<15s) was met"
            }
          }
        }
      },
      "additionalProperties": false
    },

    "marketplace_compliance": {
      "type": "object",
      "description": "Marketplace-specific compliance summary",
      "required": [
        "compliant_marketplaces",
        "rules_applied"
      ],
      "properties": {
        "compliant_marketplaces": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["mercadolivre", "shopee", "magalu", "amazon_br"]
          },
          "description": "Marketplaces where this output is compliant"
        },
        "rules_applied": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Specific compliance rules applied",
          "examples": [
            "ML: Scene 1 white bg #FFFFFF (main thumbnail)",
            "Shopee: Exactly 9 images maximum",
            "Amazon BR: No watermarks, no text overlay",
            "Magalu: High-key lighting for product clarity"
          ]
        },
        "non_compliance_risks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "marketplace": {"type": "string"},
              "risk": {"type": "string"},
              "recommendation": {"type": "string"}
            }
          },
          "description": "Potential compliance issues and fixes"
        }
      },
      "additionalProperties": false
    },

    "trinity_output": {
      "type": "object",
      "description": "Trinity output pattern file references",
      "required": [
        "markdown",
        "llm_json",
        "metadata_json"
      ],
      "properties": {
        "markdown": {
          "type": "string",
          "pattern": "\\.md$",
          "description": "Human-readable markdown with copy-paste prompts",
          "examples": ["product_photos_garrafa_agua.md"]
        },
        "llm_json": {
          "type": "string",
          "pattern": "\\.llm\\.json$",
          "description": "LLM-consumable JSON for automation",
          "examples": ["product_photos_garrafa_agua.llm.json"]
        },
        "metadata_json": {
          "type": "string",
          "pattern": "\\.meta\\.json$",
          "description": "Metadata for tracking and quality",
          "examples": ["product_photos_garrafa_agua.meta.json"]
        }
      },
      "additionalProperties": false
    },

    "anuncio_integration": {
      "type": "object",
      "description": "Integration notes for anuncio_agent workflow",
      "properties": {
        "ready_for_anuncio": {
          "type": "boolean",
          "description": "TRUE if output can be directly used by anuncio_agent"
        },
        "recommended_scenes": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 1,
            "maximum": 9
          },
          "description": "Recommended scene numbers for marketplace listing (typically [1, 2, 3, 5, 9])"
        },
        "prompt_compatibility": {
          "type": "string",
          "enum": ["midjourney", "dalle3", "stable_diffusion", "gemini_imagen", "all"],
          "description": "Which AI image generators support these prompts"
        }
      }
    },

    "input_echo": {
      "type": "object",
      "description": "Echo of original input for reference",
      "properties": {
        "subject": {"type": "string"},
        "marketplace": {"type": "string"},
        "reference_image_provided": {"type": "boolean"}
      }
    }
  },

  "additionalProperties": false,

  "examples": [
    {
      "metadata": {
        "agent": "photo_agent_marketplace",
        "version": "1.0.0",
        "timestamp": "2025-11-15T10:00:00Z",
        "input_hash": "abc123...",
        "workflow_type": "marketplace_product",
        "generation_time_ms": 8500,
        "input_subject": "Garrafa de água reutilizável ecológica 750ml aço inox",
        "target_marketplace": "all",
        "anuncio_agent_integration": true
      },
      "prompts_grid_3x3": [
        {
          "scene_number": 1,
          "scene_name": "Hero White Background (Marketplace Thumbnail)",
          "scene_role": "hero_white",
          "prompt_with_reference": "Professional product photography fiel ao {INSERIR_IMAGEM_PRODUTO_AQUI}, garrafa de água reutilizável 750ml aço inox, pure white background #FFFFFF, centered composition rule of thirds, camera 50mm f/8 1/160s ISO 100, high-key lighting soft uniform shadows, full sharp focus mostrando textura do aço, PNL: clareza imediata na escolha, no watermarks, no text, no third-party logos, 8K quality, marketplace compliant",
          "reference_image_instructions": "⚠️ ANTES DE GERAR: Cole/anexe a imagem da garrafa no lugar de {INSERIR_IMAGEM_PRODUTO_AQUI}. Sem a imagem, a IA vai inventar uma garrafa genérica.",
          "technical_specs": {
            "camera": "50mm f/8 1/160s ISO 100",
            "focal_length": "50mm",
            "aperture": "f/8",
            "shutter_speed": "1/160s",
            "iso": 100,
            "lighting": "High-key clean, soft uniform shadows",
            "background": "#FFFFFF pure white",
            "composition": "Centered, rule of thirds",
            "depth_of_field": "full_focus"
          },
          "compliance_white_bg": true,
          "marketplace_purpose": "main_thumbnail",
          "pnl_trigger": "clareza imediata na escolha, produto confiável",
          "pnl_trigger_key": "clareza",
          "validation_score": 0.96,
          "character_count": 287,
          "validation_status": "PASS",
          "file_name_suggestion": "garrafa_agua_cena_01_hero_branco.png"
        }
      ],
      "reference_instructions": {
        "workflow_overview": "Este output gera 9 PROMPTS prontos para copiar e colar. CADA PROMPT contém {INSERIR_IMAGEM_PRODUTO_AQUI} que você DEVE substituir pela imagem real do produto antes de gerar.",
        "step_by_step": [
          "1. Tenha a IMAGEM DO PRODUTO pronta (PNG, JPG, ou URL)",
          "2. Copie o PROMPT da cena (ex: Cena 1)",
          "3. COLE a imagem no lugar de {INSERIR_IMAGEM_PRODUTO_AQUI}",
          "4. Cole o prompt na LLM geradora",
          "5. Gere. Repita para as 9 cenas."
        ],
        "fidelity_guarantee": "Anexar a imagem em CADA geração garante fidelidade 100% ao produto em todas as 9 cenas.",
        "supported_formats": ["PNG", "JPG", "JPEG", "WEBP", "URL"],
        "recommended_resolution": "1024x1024 mínimo, 2048x2048 ideal"
      },
      "quality_report": {
        "total_prompts": 9,
        "validation_passed": 9,
        "validation_failed": 0,
        "avg_validation_score": 0.94,
        "avg_character_count": 295,
        "marketplace_compliance_status": "FULL_COMPLIANCE",
        "white_bg_scenes_count": 2,
        "white_bg_scenes": [1, 9],
        "compliance_details": {
          "scene_1_white_bg": true,
          "scene_9_white_bg": true,
          "all_lengths_valid": true,
          "all_camera_specified": true,
          "all_lighting_described": true,
          "all_background_mentioned": true,
          "all_composition_defined": true,
          "all_8k_stated": true,
          "all_no_watermarks": true,
          "all_no_text": true,
          "all_no_logos": true,
          "all_pnl_included": true,
          "all_reference_placeholder": true
        },
        "warnings": [],
        "errors": []
      },
      "marketplace_compliance": {
        "compliant_marketplaces": ["mercadolivre", "shopee", "magalu", "amazon_br"],
        "rules_applied": [
          "ML: Scene 1 white bg for thumbnail",
          "Shopee: 9 images max",
          "Amazon: No watermarks/text",
          "Magalu: High-key lighting"
        ]
      },
      "trinity_output": {
        "markdown": "garrafa_agua_marketplace.md",
        "llm_json": "garrafa_agua_marketplace.llm.json",
        "metadata_json": "garrafa_agua_marketplace.meta.json"
      },
      "anuncio_integration": {
        "ready_for_anuncio": true,
        "recommended_scenes": [1, 2, 3, 5, 9],
        "prompt_compatibility": "all"
      }
    }
  ]
}
